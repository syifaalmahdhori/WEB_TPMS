<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TPMS Fuzzy Sugeno (Bootstrap)</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    /* ========== THEME BASE ========== */
    body { background:#0b1220; color:#e9edf3; }

    .card{
      background:#121a2b; border:1px solid #1f2b46;
      /* header/footer card kontras */
      --bs-card-cap-bg:#0e1626;
      --bs-card-cap-color: rgb(233,237,243);
      --bs-card-cap-border-color:#1f2b46;
    }
    .form-range::-webkit-slider-thumb { background:#0d6efd; }
    .badge-pill { border-radius:2rem; }

    .mono { 
      font-variant-numeric: tabular-nums; 
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; 
      color: rgb(0, 224, 255);
      letter-spacing: .02em;
    }

    .card-header, .muted, .form-label, .display-6, .mb-2, .mono  { color:#ffffff; }
    .table thead th { color:#a7b3c6; }
    a { color:#9ec1ff; }

    /* ========== SIDEBAR ========== */
    :root{
      --sidebar-w: 256px;
      --sidebar-bg: #0e1626;
      --sidebar-border: #1f2b46;
      --sidebar-link: #c7d2e5;
      --sidebar-link-active-bg: #16233b;
      --sidebar-link-active: #ffffff;
    }

    /* topbar untuk tombol hamburger di mobile */
    .topbar {
      position: sticky; top: 0; z-index: 1050;
      background: #0b1220; border-bottom: 1px solid #1f2b46;
    }

    /* wrapper konten agar bergeser saat desktop */
    .content-wrap { transition: margin-left .25s ease; }

    /* Sidebar fixed kiri */
    .sidebar {
      position: fixed; inset: 0 auto 0 0; width: var(--sidebar-w);
      background: var(--sidebar-bg); border-right:1px solid var(--sidebar-border);
      transform: translateX(-100%); /* hidden default (mobile) */
      transition: transform .25s ease;
      padding-top: 60px; /* ruang top untuk topbar */
      z-index: 1040;
    }
    .sidebar.show { transform: translateX(0); }

    /* Desktop: sidebar selalu terlihat */
    @media (min-width: 992px){
      .sidebar { transform: none; }
      .content-wrap { margin-left: var(--sidebar-w); }
      .topbar .btn-toggle { display: none; } /* sembunyikan tombol di desktop */
      .sidebar { padding-top: 0; } /* topbar tak menutup sidebar di desktop */
    }

    .sidebar .brand {
      padding: 16px 18px; border-bottom:1px solid var(--sidebar-border);
      font-weight: 700; letter-spacing:.3px;
    }
    .sidebar .nav-link{
      color: var(--sidebar-link);
      padding: 10px 16px; border-radius: .5rem; margin: 4px 8px;
    }
    .sidebar .nav-link:hover{ background: rgba(255,255,255,.03); color: #fff; }
    .sidebar .nav-link.active{
      background: var(--sidebar-link-active-bg); color: var(--sidebar-link-active);
    }
    .sidebar small.section { 
      display:block; color:#8fa1bf; padding: 10px 18px 4px; margin-top: 8px;
      text-transform: uppercase; letter-spacing:.08em; font-size: .73rem;
    }
  </style>
</head>
<body>
  <!-- TOPBAR (mobile) -->
  <div class="topbar">
    <div class="container-fluid py-2 d-flex align-items-center justify-content-between">
      <button class="btn btn-outline-light btn-sm btn-toggle" type="button" aria-label="Toggle sidebar" onclick="toggleSidebar()">
        ☰
      </button>
      <div class="small text-muted">TPMS – Fuzzy Logic Sugeno</div>
    </div>
  </div>

  <!-- SIDEBAR -->
  <nav id="sidebar" class="sidebar" aria-label="Sidebar Navigasi">
    <div class="brand">TPMS Dashboard</div>
    <small class="section">Navigasi</small>
    <ul class="nav flex-column mb-2">
      <!-- Ganti href ke file/halamanmu -->
      <li class="nav-item"><a class="nav-link active" href="index.html">Beranda</a></li>
      <li class="nav-item"><a class="nav-link" href="membership.html">Membership Function</a></li>
      <li class="nav-item"><a class="nav-link" href="rules.html">Aturan (Rule Base)</a></li>
      <li class="nav-item"><a class="nav-link" href="charts.html">Grafik & Hasil</a></li>
      <li class="nav-item"><a class="nav-link" href="realtime.html">Realtime</a></li>
      <li class="nav-item"><a class="nav-link" href="table.html">Tabel Data</a></li>
      <li class="nav-item"><a class="nav-link" href="about.html">Tentang</a></li>
    </ul>

    <small class="section">Dokumentasi</small>
    <ul class="nav flex-column">
      <li class="nav-item"><a class="nav-link" href="#metode">Metode Sugeno</a></li>
      <li class="nav-item"><a class="nav-link" href="#domain">Domain Himpunan</a></li>
      <li class="nav-item"><a class="nav-link" href="#hasil">Hasil Perhitungan</a></li>
    </ul>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="content-wrap">
    <div class="container py-4">
      <header class="mb-4">
        <h1 class="h3 fw-bold">TPMS – Fuzzy Logic Metode Sugeno</h1>
        <p class="muted mb-0">Input: <strong>Tekanan</strong> (psi), <strong>Suhu</strong> (°C), <strong>Kecepatan</strong> (km/jam). Output: nilai crisp <strong>Z (0–100)</strong> dan status <strong>Aman/Waspada/Bahaya</strong>.</p>
      </header>

      <div class="row g-4">
        <!-- INPUTS -->
        <div class="col-lg-5">
          <div class="card">
            <div class="card-header"><strong>1) Input Sensor</strong></div>
            <div class="card-body">
              <div class="mb-4">
                <label class="form-label">Tekanan (psi): <span id="pVal" class="mono"></span></label>
                <input type="range" class="form-range" min="0" max="40" step="0.1" id="p" value="23">
                <div class="d-flex justify-content-between muted"><small>0</small><small>40</small></div>
              </div>
              <div class="mb-4">
                <label class="form-label">Suhu (°C): <span id="tVal" class="mono"></span></label>
                <input type="range" class="form-range" min="0" max="40" step="0.1" id="t" value="28">
                <div class="d-flex justify-content-between muted"><small>0</small><small>40</small></div>
              </div>
              <div class="mb-2">
                <label class="form-label">Kecepatan (km/jam): <span id="sVal" class="mono"></span></label>
                <input type="range" class="form-range" min="0" max="120" step="1" id="s" value="50">
                <div class="d-flex justify-content-between muted"><small>0</small><small>120</small></div>
              </div>
            </div>
          </div>

          <div class="card mt-4" id="domain">
            <div class="card-header"><strong>2) Himpunan Fuzzy (Domain)</strong></div>
            <div class="card-body">
              <div class="row">
                <div class="col-12">
                  <p class="mb-2"><strong>Tekanan (psi)</strong></p>
                  <ul class="small muted">
                    <li>Sangat Kurang: [0, 0, 16, 18]</li>
                    <li>Kurang: [16, 18, 22, 24]</li>
                    <li>Normal: [22, 24, 34, 36]</li>
                    <li>Tinggi: [34, 36, 40, 40]</li>
                  </ul>
                </div>
                <div class="col-12">
                  <p class="mb-2"><strong>Suhu (°C)</strong></p>
                  <ul class="small muted">
                    <li>Dingin: [0, 0, 16, 20]</li>
                    <li>Normal: [16, 20, 30, 34]</li>
                    <li>Panas: [30, 34, 40, 40]</li>
                  </ul>
                </div>
                <div class="col-12">
                  <p class="mb-2"><strong>Kecepatan (km/jam)</strong></p>
                  <ul class="small muted">
                    <li>Lambat: [0, 0, 15, 25]</li>
                    <li>Normal: [15, 25, 45, 55]</li>
                    <li>Cepat: [45, 55, 120, 120]</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- RESULTS -->
        <div class="col-lg-7" id="hasil">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <strong>3) Hasil Perhitungan</strong>
              <span id="statusBadge" class="badge bg-secondary badge-pill">Status</span>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="p-3 rounded-3" style="background:#0e1626;border:1px dashed #223153;">
                    <div class="muted small mb-2">Derajat Keanggotaan (μ)</div>
                    <div id="muList" class="mono small"></div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="p-3 rounded-3" style="background:#0e1626;border:1px dashed #223153;">
                    <div class="muted small mb-2">Defuzzifikasi (Sugeno Weighted Average)</div>
                    <div class="d-flex align-items-baseline gap-3">
                      <div class="display-6 mono" id="zVal">0.00</div>
                      <div class="muted">Z (0–100)</div>
                    </div>
                    <div class="small muted mt-2">Kategori: <span id="kategori" class="text-white fw-semibold"></span></div>
                  </div>
                </div>
              </div>

              <hr class="my-4">

              <div class="muted small mb-2" id="metode">Basis Aturan Sugeno (konstanta output)</div>
              <div class="table-responsive">
                <table class="table table-sm align-middle mb-0">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>IF</th>
                      <th>THEN</th>
                      <th>zᵢ</th>
                      <th>α (min)</th>
                      <th>α·zᵢ</th>
                    </tr>
                  </thead>
                  <tbody id="ruleRows"></tbody>
                  <tfoot>
                    <tr>
                      <th colspan="4" class="text-end">Σ α</th>
                      <th class="mono" id="sumAlpha">0.00</th>
                      <th class="mono" id="sumAlphaZ">0.00</th>
                    </tr>
                  </tfoot>
                </table>
              </div>

              <div class="small muted mt-3">
                <span class="d-block">Konstanta output: Aman=20, Waspada=55, Bahaya=85</span>
                <span class="d-block">Status akhir: Aman (0–40), Waspada (40–70), Bahaya (70–100)</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer class="mt-4 text-center muted small">
         © 2025 – TPMS Fuzzy Sugeno oleh Ghathfan Shah Sudibyo | 2020230028
      </footer>
    </div>
  </main>

  <!-- SCRIPT -->
  <script>
    // Toggle sidebar (mobile)
    function toggleSidebar(){
      document.getElementById('sidebar').classList.toggle('show');
    }

    // Tandai link aktif berdasar URL
    (function markActive(){
      const links = document.querySelectorAll('.sidebar .nav-link');
      const here = location.pathname.split('/').pop() || 'index.html';
      links.forEach(a=>{
        const target = a.getAttribute('href');
        if(target === here){ a.classList.add('active'); }
      });
    })();

    // Util: membership trapezoid (aman untuk kasus a=b atau c=d)
    function muTrap(x, a, b, c, d) {
      if (x <= a || x >= d) return 0;
      if (b === a && x <= b) return 1; // sisi kiri tegak
      if (d === c && x >= c) return 1; // sisi kanan tegak
      if (x > a && x <= b) return (x - a) / (b - a);
      if (x > b && x < c) return 1;
      if (x >= c && x < d) return (d - x) / (d - c);
      return 0;
    }

    // Domains
    const P = { SK:[0,0,16,18], K:[16,18,22,24], N:[22,24,34,36], T:[34,36,40,40] };
    const Tm = { D:[0,0,16,20], N:[16,20,30,34], P:[30,34,40,40] };
    const S = { L:[0,0,15,25], N:[15,25,45,55], C:[45,55,120,120] };

    // Rule list (Sugeno dgn konstanta z_i)
    const RULES = [
      { if:'Tekanan Sangat Kurang', z:85, a:(u)=>u.p.SK },                                   // 1
      { if:'Tekanan Kurang ∧ Suhu Normal', z:55, a:(u)=>Math.min(u.p.K, u.t.N) },            // 2
      { if:'Tekanan Normal ∧ Suhu Normal', z:20, a:(u)=>Math.min(u.p.N, u.t.N) },            // 3
      { if:'Tekanan Normal ∧ Suhu Panas',  z:55, a:(u)=>Math.min(u.p.N, u.t.P) },            // 4
      { if:'Tekanan Tinggi',               z:85, a:(u)=>u.p.T },                              // 5
      { if:'Tekanan Kurang ∧ Kecepatan Cepat', z:85, a:(u)=>Math.min(u.p.K, u.s.C) },        // 6
      { if:'Tekanan Normal ∧ Kecepatan Cepat', z:55, a:(u)=>Math.min(u.p.N, u.s.C) },        // 7
      { if:'Tekanan Kurang ∧ Kecepatan Normal', z:55, a:(u)=>Math.min(u.p.K, u.s.N) },       // 8
      { if:'Tekanan Normal ∧ Suhu Dingin', z:20, a:(u)=>Math.min(u.p.N, u.t.D) },            // 9
    ];

    // Elements
    const pEl = document.getElementById('p');
    const tEl = document.getElementById('t');
    const sEl = document.getElementById('s');
    const pVal = document.getElementById('pVal');
    const tVal = document.getElementById('tVal');
    const sVal = document.getElementById('sVal');
    const muList = document.getElementById('muList');
    const ruleRows = document.getElementById('ruleRows');
    const sumAlpha = document.getElementById('sumAlpha');
    const sumAlphaZ = document.getElementById('sumAlphaZ');
    const zVal = document.getElementById('zVal');
    const badge = document.getElementById('statusBadge');
    const kategori = document.getElementById('kategori');

    function fmt(n){ return Number(n).toFixed(2); }

    function compute() {
      const pv = parseFloat(pEl.value);
      const tv = parseFloat(tEl.value);
      const sv = parseFloat(sEl.value);
      pVal.textContent = pv.toFixed(1);
      tVal.textContent = tv.toFixed(1);
      sVal.textContent = sv.toFixed(0);

      // Fuzzifikasi
      const u = {
        p: {
          SK: muTrap(pv, ...P.SK),
          K : muTrap(pv, ...P.K),
          N : muTrap(pv, ...P.N),
          T : muTrap(pv, ...P.T),
        },
        t: {
          D : muTrap(tv, ...Tm.D),
          N : muTrap(tv, ...Tm.N),
          P : muTrap(tv, ...Tm.P),
        },
        s: {
          L : muTrap(sv, ...S.L),
          N : muTrap(sv, ...S.N),
          C : muTrap(sv, ...S.C),
        }
      };

      muList.innerHTML = `
        <div>Tekanan → SK: <b>${fmt(u.p.SK)}</b>, K: <b>${fmt(u.p.K)}</b>, N: <b>${fmt(u.p.N)}</b>, T: <b>${fmt(u.p.T)}</b></div>
        <div>Suhu → D: <b>${fmt(u.t.D)}</b>, N: <b>${fmt(u.t.N)}</b>, P: <b>${fmt(u.t.P)}</b></div>
        <div>Kecepatan → L: <b>${fmt(u.s.L)}</b>, N: <b>${fmt(u.s.N)}</b>, C: <b>${fmt(u.s.C)}</b></div>
      `;

      // Evaluasi aturan
      let rows = '';
      let sumA = 0, sumAZ = 0;
      RULES.forEach((r, i) => {
        const a = r.a(u);
        const az = a * r.z;
        sumA += a; sumAZ += az;
        rows += `
          <tr>
            <td class="mono">${i+1}</td>
            <td>${r.if}</td>
            <td>${r.z===20?'Aman':(r.z===55?'Waspada':'Bahaya')}</td>
            <td class="mono">${fmt(r.z)}</td>
            <td class="mono">${fmt(a)}</td>
            <td class="mono">${fmt(az)}</td>
          </tr>`;
      });
      ruleRows.innerHTML = rows;
      sumAlpha.textContent = fmt(sumA);
      sumAlphaZ.textContent = fmt(sumAZ);

      const Z = sumA > 0 ? (sumAZ / sumA) : 0;
      zVal.textContent = fmt(Z);

      // Kategori status
      let status = 'Aman', cls='bg-success';
      if (Z >= 70) { status='Bahaya'; cls='bg-danger'; }
      else if (Z >= 40) { status='Waspada'; cls='bg-warning text-dark'; }
      badge.className = 'badge badge-pill ' + cls;
      badge.textContent = status;
      kategori.textContent = status;
    }

    ['input','change'].forEach(evt => {
      pEl.addEventListener(evt, compute);
      tEl.addEventListener(evt, compute);
      sEl.addEventListener(evt, compute);
    });

    // init
    compute();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
